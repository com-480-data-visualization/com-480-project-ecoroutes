L.Curve=L.Path.extend({options:{},initialize:function(o,t){L.setOptions(this,t),this._setPath(o)},getPath:function(){return this._coords},setPath:function(o){return this._setPath(o),this.redraw()},getBounds:function(){return this._bounds},_setPath:function(o){this._coords=o,this._bounds=this._computeBounds()},_computeBounds:function(){for(var o=new L.LatLngBounds,t,r,n=0;n<this._coords.length;n++)if(coord=this._coords[n],typeof coord=="string"||coord instanceof String)r=coord;else if(r=="H")o.extend([t.lat,coord[0]]),t=new L.latLng(t.lat,coord[0]);else if(r=="V")o.extend([coord[0],t.lng]),t=new L.latLng(coord[0],t.lng);else if(r=="C"){var a=new L.latLng(coord[0],coord[1]);coord=this._coords[++n];var c=new L.latLng(coord[0],coord[1]);coord=this._coords[++n];var e=new L.latLng(coord[0],coord[1]);o.extend(a),o.extend(c),o.extend(e),e.controlPoint1=a,e.controlPoint2=c,t=e}else if(r=="S"){var c=new L.latLng(coord[0],coord[1]);coord=this._coords[++n];var e=new L.latLng(coord[0],coord[1]),a=t;if(t.controlPoint2){var s=t.lat-t.controlPoint2.lat,d=t.lng-t.controlPoint2.lng;a=new L.latLng(t.lat+s,t.lng+d)}o.extend(a),o.extend(c),o.extend(e),e.controlPoint1=a,e.controlPoint2=c,t=e}else if(r=="Q"){var i=new L.latLng(coord[0],coord[1]);coord=this._coords[++n];var e=new L.latLng(coord[0],coord[1]);o.extend(i),o.extend(e),e.controlPoint=i,t=e}else if(r=="T"){var e=new L.latLng(coord[0],coord[1]),i=t;if(t.controlPoint){var s=t.lat-t.controlPoint.lat,d=t.lng-t.controlPoint.lng;i=new L.latLng(t.lat+s,t.lng+d)}o.extend(i),o.extend(e),e.controlPoint=i,t=e}else o.extend(coord),t=new L.latLng(coord[0],coord[1]);return o},getCenter:function(){return this._bounds.getCenter()},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updatecurve(this)},_project:function(){var o,t,r,n;this._points=[];for(var a=0;a<this._coords.length;a++)if(o=this._coords[a],typeof o=="string"||o instanceof String)this._points.push(o),r=o;else{switch(o.length){case 2:n=this._map.latLngToLayerPoint(o),t=o;break;case 1:r=="H"?(n=this._map.latLngToLayerPoint([t[0],o[0]]),t=[t[0],o[0]]):(n=this._map.latLngToLayerPoint([o[0],t[1]]),t=[o[0],t[1]]);break}this._points.push(n)}}}),L.curve=function(o,t){return new L.Curve(o,t)},L.SVG.include({_updatecurve:function(o){this._setPath(o,this._curvePointsToPath(o._points))},_curvePointsToPath:function(o){for(var t,r,n="",a=0;a<o.length;a++)if(t=o[a],typeof t=="string"||t instanceof String)r=t,n+=r;else switch(r){case"H":n+=t.x+" ";break;case"V":n+=t.y+" ";break;default:n+=t.x+","+t.y+" ";break}return n||"M0 0"}});
